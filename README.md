# Cindicator test task

**Задание:**
1. Напиши, пожалуйста, скрипт, который подписывается по [websocket на binance](https://github.com/binance/binance-spot-api-docs/blob/master/web-socket-streams.md#klinecandlestick-streams), получает оттуда минутные свечи для пар: BTC/USDT, ETH/USDT, BNB/BTC. 
2. По свечкам посчитай скользящее среднее для каждой пары отдельно и выведи в лог. Плюсом будет, если сможешь упаковать в docker контейнер.
3. Сделай unit tests.

**Описание решения:**
Я вычислял экспоненциальное скользящее среднее(EMA) с двумя входными параметрами: 
*marker* - количество минутных свеч, для которых будет рассчитано EMA
*smoothing interval* - количество первых минутных свеч,  по которым будет рассчитана первая EMA
Расчетная формула:  *EMA=Price(t)×alpha+EMA(y)×(1−alpha)*
В качестве цены была использована **цена закрытия** минутной свечи.

Также в попытке сравнивать мой подход с подходом сообщества трейдеров я воспользовался с библиотекой [bta-lib](https://github.com/mementum/bta-lib "bta-lib"). Чтобы сравнить, я написал несколько Unit testов(изменяя входные параметры и используя сгенерированные мною close_prices). Однако наши результаты расходятся в большинстве случаев. Это связано с известной [проблемой](https://github.com/mementum/bta-lib/issues/2 "проблемой") библиотеки: при передачи начального значения(*_seed*) EMA в качестве аргумента возникают странные последствия(либо игнорируется, либо error).
Но для сравнения в самый раз - прогнать тесты, отрисовать график, сравнить.

Таким образом, на выход(в логи) мы получаем EMA, рассчитанное библиотекой и моим способом. Первые значение при выводе равны NaN, поскольку по ним считается EMA(1).

**Комментарии:**
- Если вы ввели marker 100 и smoothing_interval 10, то придется ждать 110 минут;
- *Socket Binance Warning* в логах пофиксить не смог, почему-то не закрывается норм Sоcket(возможно, не отвечает серверу на последний запрос)
- В папке *charts* лежат графики, построенные на *plotly.express*. Этого не было в задании, но я хотел визуализировать разницу между моим подходом и bta-lib.  Уверен, минусом не будет.
- В Docker-образе графики не строятся, т.к. пытался по максимум сократить размер образа, отказываясь от зависимостей. Код на гитхабе графики строит. 

**Запуск образа:**
- Файл *dockerfile.rar*  в репозитории - это образ Docker-контейнера *.tar,* упакованный в *.rar*;
- При запуске образа передавайте параметры *-m* и *-s*,
где *-m* - marker,  *-s* - smoothing_interval:
` docker run dockerfile -m 10 -s 2`

------------
*При любом исходе был бы рад получить обратную связь по решению: что улучшить, что кардинально не так и т.п.*
